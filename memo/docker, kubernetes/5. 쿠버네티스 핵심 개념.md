# 쿠버네티스 핵심 개념

## 큐브 시스템 컴포넌트

### 1. 큐브 API 서버

* 쿠버네티스 시스템 컴포넌트는 오직 API 서버와 통신한다.
  * 컴포넌트끼리 서로 통신하는 일은 없다.
  * 컴포넌트끼리 서로 통신할때는 API 서버를 중계하여야 함
* RestfulAPI를 통해 클러스터 상태를 쿼리, 수정할 수 잇는 기능 제공
* API 서버의 구체적인 역활
  * 인증 플러그인을 사용한 클라이언트 인증
  * 권한 승인 플러그인을 통한 클라이언트 인증
  * 승인 제어 플러그인을 통해 요청 받은 리소스를 확인/수정
  * 리소스 검증 및 영구 저장



### 2. 큐브 컨트롤러 매니저

* 컨트롤러에는 다양한 컨트롤러가 존재
* API에 의해 받아진 요청을 처리하는 역활
  * 레플리케이션 매너저
  * 레플리카셋, 데몬셋, 잡 컨트롤러
  * 디플로이먼트 컨트롤러
  * ...



### 3. 큐브 스케줄러

* 일반적으로 실행할 노드를 직접 정해주지 않음
* 요청 받은 리소스를 어느 노드에 실행할지 경정하는 역활
* 현재 노드의 상태를 점검하고 최상의 노드를 찾아 배치
* 다수의 포드를 배치하는 경우에는 `라운드로빈`을 사용하여 분산



## 큐브시스템에서 사용하는 포드 확인

```bash
kubectl get pod -n kube-system
```

**실행결과**

![image-20210220212811518](http://www.jimbae.com:59005/image/154)



## 큐브시스템 설정 변경법

* `/etc/kubernetes/manifests/` 하위의 `.yml` 파일의 설정을 변경하면 된다.





## ETCD 데이터베이스 살펴보기

* etcd 는 쿠버네티스에서 사용 하는 Open Source 데이터베이스 이다.
* Key-Value Set 기반 데이터베이스

**![image-20210221211938033](http://www.jimbae.com:59005/image/155)**



### 쿠버네티스 - ETCD 데이터베이스 키 구조

![image-20210221220534755](http://www.jimbae.com:59005/image/156)



### 직접 ETCD 사용해보기

> 깃허브 주소 : https://github.com/etcd-io/etcd/releases

```bash
wget https://github.com/etcd-io/etcd/releases/download/v3.4.14/etcd-v3.4.14-linux-amd64.tar.gz #다운로드
tar -xf etcd-v3.4.14-linux-amd64.tar.gz #압축풀기
cd ./etcd-v3.4.14-linux-amd64 #폴더안에 etcdctl 명령어 존재
sudo ETCDCTL_API=3 ./etcdctl --endpoints 127.0.0.1:2379 --cacert /etc/kubernetes/pki/etcd/ca.crt --cert /etc/kubernetes/pki/etcd/server.crt --key /etc/kubernetes/pki/etcd/server.key get / --prefix --keys-only #ETCD 내장 내용 확인
```



**데이터 입출력 예제**

```bash
sudo ETCDCTL_API=3 ./etcdctl --endpoints 127.0.0.1:2379 --cacert /etc/kubernetes/pki/etcd/ca.crt --cert /etc/kubernetes/pki/etcd/server.crt --key /etc/kubernetes/pki/etcd/server.key put key1 value1 #key1 value1 입력
sudo ETCDCTL_API=3 ./etcdctl --endpoints 127.0.0.1:2379 --cacert /etc/kubernetes/pki/etcd/ca.crt --cert /etc/kubernetes/pki/etcd/server.crt --key /etc/kubernetes/pki/etcd/server.key get key1  #key1 cnffur
```





