# 영속성 관리

## 영속성 컨텍스트

* 엔티티를 영구 저장하는 환경
* 영속성 컨텍스트는 논리적인 개념이다.
* 엔티티 매니저를 통해서 영속성 컨텍스트에 접근.



## 엔티티의 생명주기

* 비영속
  * 영속성 컨텍스트와 전혀 관계가 없는 새로운 상태
  * 객체를 생성하였지만 EntityManager와 아무런 관련이 없는 상태
* 영속
  * 영속성 컨텍스트에 관리되는 상태
  * 생성한 엔티티 객체를 영속성 컨텍스트 안에 집어 넣은 상태
* 준영속
  * 영속성 컨텍스트에 저장되었다가 분리된 상태
* 삭제
  * 삭제된 상태



## 영속성 컨텍스트의 이점

* 1차 캐시
* 동일성 보장
* 트랜잭션을 지원하는 쓰기 지연
* 변경 감지
* 지연 로딩



### 1차 캐시

* 영속성 컨텍스트 내부에 1차캐시는 맵과 같은 Key, Value 형태의 1차 캐시가 존재한다.
* 1차 캐시에서 Key 를 통한 조회시, DB 조회가 아닌 1차 캐시에 저장된 내용을 반환해 준다.
* 1차 캐시에 존재하지 않는 Key 를 통한 조회시 DB 조회를 통해 영속성 컨텍스트에서 관리를 할수 있게 된다.
* 트랜잭션이 끝나면 1차 캐시도 끝나기 떄문에 성능적 이점이 그렇게 크지는 않다..



### 동일성 보장

* 같은키로 조회시 같은 객체로 이해한다.



### 쓰기 지연

* 한 트랜잭션 안에서 발생한 영속성 컨텍스트 변경을 일괄적으로 처리한다. [버퍼링 처리]



### 변경감지 [더티체킹]

* 엔티티 내부의 변경을 자동으로 감지하여 수정한다.
* 엔티티와 1차 캐시에 저장된 스냅샷을 비교하여 변경된 값을 자동으로 수정한다.







