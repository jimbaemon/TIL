# SpringCloud 기반 MSA 환경 K8S로 전환하기 [16:00]

* 샵바이 소개
* 쿠버네티스로 전환하는 이유
* 쿠버네티스 전환 준비하기
* 쿠버네티스 배포하기
* 쿠버네티스 전환하기



## 샵바이 소개

* 클라우드 이커머스
* MSA 기반 운영중 OPEN API



## 쿠버네티스 전환하는 이유

* 마이크로 서비스가 너무 많다.
  * 관리의 어려움
  * 스케줄링과 스케일링을 직접 진행

* 서버 장애 대응
  * 서버가 장애나는 경우 Ansible 을통한 배포서버를 직접 지정하는 방법을 사용했었음.
* 오토 스케일링
  * 트래픽 양에 따른 오토스케일링을 사용
  * 이벤트 중인 쇼핑몰의 트래픽이 다른 쇼핑몰 9개의 3배의 트래픽이 나오기도함
  * 이것은 오토 스케일링으로는 해결이 불가능하므로 미리 자원을 늘려놓는[스케일 아웃] 작업을 한다.



## 쿠버네티스 전환 준비

* 코드 변경없이 애플리케이션으로 쿠버네티스로 전환
  * 전환후 문제가 발생하는 경우 롤백하는데 유연하게 대처하기 위해 
    * 쿠버네티스로 전환했는데 문제가 생겼는데 이미 쿠버네티스 의존적이라면 롤백이 불가능
  * Dependency에 대한 조사
    * 사진 붙여넣기
  * 서비스 레지스트리
    * Zookeeper -> K8s Service
    * Feign Client -> Service URL [의존적]\[미사용]
    * Spring Cloud Kubernetes -> Zookeeper 와 동일하게 Service로 전환 가능
  * Spring Cloud Gateway
    * Custom Filter 를 사용하는게 많고 포팅해 줘야 하기 때문에 Spring Cloud Gateway 유지
  * 프로퍼티 파일 관리
    * ConfigMap 이 가지는 단점 -> 파드 종속성등이나 보안적 문제가 존재
    * Spring Cloud Kubernetes Config 를 이용해 기존 설정을 이용해서 Configmap 방식으로 이용
  * dependecy 정리
    * 양쪽환경에 설정 파일을 모두 가지고 있도록 설정
    * zookeper 설정 유지 k8s 설정에서 zookeeper 설정 disable -> 문제 생기면 K8s 설정 제거

* 쿠버네티스에서 제공하는 기능을 적극적으로 활용함



## 쿠버네티스에 배포

* 리소스[Manifest]파일을 지속적으로 관리해주는데 어려움이 있음
  * 실수가 잦을수 밖에 없다....
  * Helm으로 패키징해서 사용한다.
  * Jenkins 와 Argo를 이용한 자동화



## 쿠버네티스로 전환하기

* 트래픽 전환전력
  * 8000여개의 쇼핑몰 운영중이므로 무중단으로 해야함.
  * GSLB 를 이용
  * 카나리 기법 이용 

